const axios = require('axios');

const baseApiUrl = async () => {
    const base = await axios.get(`https://raw.githubusercontent.com/Blankid018/D1PT0/main/baseApiUrl.json`);
    return base.data.api;
};

module.exports.config = {
  name: "baby",
  version: "6.9.9",
  credits: "dipto",
  cooldowns: 0,
  hasPermssion: 0,
  description: "better than all sim simi",
  commandCategory: "chat",
  category: "chat",
  usePrefix: true,
  prefix: true,
  usages: `[anyMessage] OR\nteach [YourMessage] - [Reply1], [Reply2], [Reply3]... OR\nteach [react] [YourMessage] - [react1], [react2], [react3]... OR\nremove [YourMessage] OR\nrm [YourMessage] - [indexNumber] OR\nmsg [YourMessage] OR\nlist OR\nall OR\nedit [YourMessage] - [NewMessage]`,
};

module.exports.run = async function ({ api, event, args, Users }) {
  try {
    const link = `${await baseApiUrl()}/baby`;
    const dipto = args.join(" ").toLowerCase();
    const uid = event.senderID;

    if (!args[0]) {
      const ran = ["Bolo baby", "hum", "type help baby", "type !baby hi"];
      const r = ran[Math.floor(Math.random() * ran.length)];
      return api.sendMessage(r, event.threadID, event.messageID);
    }

    if (args[0] === 'remove') {
      const fina = dipto.replace("remove ", "");
      const respons = await axios.get(`${link}?remove=${fina}&senderID=${uid}`);
      return api.sendMessage(respons.data.message, event.threadID, event.messageID);
    }

    if (args[0] === 'rm' && dipto.includes('-')) {
      const [fi, f] = dipto.replace("rm ", "").split(/\s*-\s*/);
      const respons = await axios.get(`${link}?remove=${fi}&index=${f}`);
      return api.sendMessage(respons.data.message, event.threadID, event.messageID);
    }

    if (args[0] === 'list') {
      if (args[1] === 'all') {
        const res = await axios.get(`${link}?list=all`);
        const data = res.data.teacher.teacherList;
        const teachers = await Promise.all(data.map(async (item) => {
          const number = Object.keys(item)[0];
          const value = item[number];
          const name = await Users.getNameUser(number).catch(()=>{}) || "unknown";
          return { name, value };
        }));
        teachers.sort((a, b) => b.value - a.value);
        const output = teachers.map((teacher, index) => `${index + 1}/ ${teacher.name}: ${teacher.value}`).join('\n');
        return api.sendMessage(`Total Teach = ${res.data.length}\n\nЁЯСС | List of Teachers of baby\n${output}`, event.threadID, event.messageID);
      } else {
        const respo = await axios.get(`${link}?list=all`);
        return api.sendMessage(`Total Teach = ${respo.data.length}`, event.threadID, event.messageID);
      }
    }

    if (args[0] === 'msg' || args[0] === 'message') {
      const fuk = dipto.replace("msg ", "");
      const respo = await axios.get(`${link}?list=${fuk}`);
      return api.sendMessage(`Message ${fuk} = ${respo.data.data}`, event.threadID, event.messageID);
    }

    if (args[0] === 'edit') {
      const command = dipto.split(/\s*-\s*/)[1];
      if (command.length < 2) {
        return api.sendMessage('тЭМ | Invalid format! Use edit [YourMessage] - [NewReply]', event.threadID, event.messageID);
      }
      const res = await axios.get(`${link}?edit=${args[1]}&replace=${command}`);
      return api.sendMessage(`changed ${res.data.message}`, event.threadID, event.messageID);
    }

    if (args[0] === 'teach' && args[1] !== 'amar' && args[1] !== 'react') {
      const [comd, command] = dipto.split(/\s*-\s*/);
      const final = comd.replace("teach ", "");
      if (command.length < 2) {
        return api.sendMessage('тЭМ | Invalid format! Use [YourMessage] - [Reply1], [Reply2], [Reply3]... OR remove [YourMessage] OR list OR edit [YourMessage] - [NewReply]', event.threadID, event.messageID);
      }
      const re = await axios.get(`${link}?teach=${encodeURIComponent(final)}&reply=${encodeURIComponent(command)}&senderID=${uid}&threadID=${event.threadID}`);
      const name = await Users.getNameUser(re.data.teacher).catch(() => {}) || "unknown";
      return api.sendMessage(`тЬЕ Replies added ${re.data.message}\nTeacher: ${name || "unknown"}\nTeachs: ${re.data.teachs}`, event.threadID, event.messageID);
    }

    if (args[0] === 'teach' && args[1] === 'amar') {
      const [comd, command] = dipto.split(/\s*-\s*/);
      const final = comd.replace("teach ", "");
      if (command.length < 2) {
        return api.sendMessage('тЭМ | Invalid format! Use [YourMessage] - [Reply1], [Reply2], [Reply3]... OR remove [YourMessage] OR list OR edit [YourMessage] - [NewReply]', event.threadID, event.messageID);
      }
      const re = await axios.get(`${link}?teach=${final}&senderID=${uid}&reply=${command}&key=intro`);
      return api.sendMessage(`тЬЕ Replies added ${re.data.message}`, event.threadID, event.messageID);
    }

    if (args[0] === 'teach' && args[1] === 'react') {
      const [comd, command] = dipto.split(/\s*-\s*/);
      const final = comd.replace("teach react ", "");
      if (command.length < 2) {
        return api.sendMessage('тЭМ | Invalid format! Use [teach] [YourMessage] - [Reply1], [Reply2], [Reply3]... OR [teach] [react] [YourMessage] - [react1], [react2], [react3]... OR remove [YourMessage] OR list OR edit [YourMessage] - [NewReply]', event.threadID, event.messageID);
      }
      const re = await axios.get(`${link}?teach=${final}&react=${command}`);
      return api.sendMessage(`тЬЕ Replies added ${re.data.message}`, event.threadID, event.messageID);
    }

    if (['amar name ki', 'amr nam ki', 'amar nam ki', 'amr name ki'].some(phrase => dipto.includes(phrase))) {
      const response = await axios.get(`${link}?text=amar name ki&senderID=${uid}&key=intro`);
      return api.sendMessage(response.data.reply, event.threadID, event.messageID);
    }

     const a = (await axios.get(`${link}?text=${dipto}&senderID=${uid}&font=1`)).data.reply;
    return api.sendMessage(a, event.threadID,
        (error, info) => {
          global.client.handleReply.push({
            name: this.config.name,
            type: "reply",
            messageID: info.messageID,
            author: event.senderID,
            lnk: a,
            apiUrl: link
          });
        }, event.messageID);

  } catch (e) {
    console.error('Error in command execution:', e);
    return api.sendMessage(`Error: ${e.message}`, event.threadID, event.messageID);
  }
};

module.exports.handleReply = async function ({ api, event, handleReply }) {
try{
  if (event.type == "message_reply") {
    const reply = event.body.toLowerCase();
    if (isNaN(reply)) {
      const b = (await axios.get(`${await baseApiUrl()}/baby?text=${encodeURIComponent(reply)}&senderID=${event.senderID}&font=1`)).data.reply;
      await api.sendMessage(b, event.threadID, (error, info) => {
          global.client.handleReply.push({
            name: this.config.name,
            type: "reply",
            messageID: info.messageID,
            author: event.senderID,
            lnk: b
          });
        }, event.messageID,
      )}}
}catch(err){
    return api.sendMessage(`Error: ${err.message}`, event.threadID, event.messageID);
}};

   
module.exports.handleEvent = async function ({ api, event }) {
try{
   const body = event.body ? event.body?.toLowerCase() : ""
        if (body.startsWith("baby") || body.startsWith("bby") || body.startsWith("bot") || body.startsWith("jan") || body.startsWith("ржмржЯ") || body.startsWith("ржЬрж╛ржи")) {
            const arr = body.replace(/^\S+\s*/, "")
        const randomReplies = ["ржЖржорж╛ржХрзЗ ржбрзЗржХрзЗржЫрзЗржи ЁЯе▓", "ржЖржорж╛рж░ рж╕рж╛ржерзЗ ржХрзЗржЙ ржХржерж╛ ржмрж▓рзЗ ржирж╛ ЁЯШФ", "ржЖржорж┐ ржПржЗ ржпрзЗ ржмрж▓рзЛ рж╕рзЛржирж╛ рждрзЛржорж╛рж░ ржЬржирзНржп ржХрж┐ ржХрж░рждрзЗ ржкрж╛рж░рж┐ ЁЯе░", "Bolo jaan ki korte panmr jonno", " ЁЯе▒ржпрзЗ рждрзЛржорж╛ржХрзЗ ржнрж╛рж▓рзЛржмрж╛рж╕рзЗ ржирж╛ рждрж╛ржХрзЗ ржЫрзЗржбрж╝рзЗ ржжрж╛ржУ ржЖрж░ ржЖржорж╛рж░ ржмрж╕ ржЪрж╛ржБржжрзЗрж░ ржкрж╛рж╣рж╛ржбрж╝ ржПрж░ рж╕рж╛ржерзЗ рж╢рзБрж░рзБ ржХрж░рзЛ ЁЯе╡ЁЯдн", " рждрзЛржорж╛рж░ рж╕рж╛ржерзЗ ржХржерж╛ ржмрж▓рждрзЗ ржирж╛ ржХрж░рзЗржЫрзЗ ржЖржорж╛рж░ ржмрж╕ ржЪрж╛ржБржжрзЗрж░ ржкрж╛рж╣рж╛ржбрж╝ ЁЯе▒ЁЯе▒", " ржЖржорж┐ рждрзЛржжрзЗрж░ ржоржд ржнрж╛рж░рзНржЪрзБржпрж╝рж╛рж▓ ржжрзЗрж░ рж╕рж╛ржерзЗ ржХржерж╛ ржмрж▓рждрзЗ ржЪрж╛ржЗ ржирж╛ ЁЯЪл ржЪрж▓ рж╣рж╛ржЯ ЁЯСЙ", " рж╣рзНржпрж╛ржБ ржмрж▓рзЛ рждрзЛржорж╛рж░ ржЬржирзНржп ржХрж┐ ржХрж░рждрзЗ ржкрж╛рж░рж┐ ЁЯШЕ", "ЁЯШЕ ржПржЗ ржжрзБржирж┐ржпрж╝рж╛рждрзЗ рж╕ржм ржорж┐ржерзНржпрж╛ ржнрж╛рж▓рзЛржмрж╛рж╕рж╛ ЁЯСЙЁЯТФ", "ЁЯЪл ржкрзНрж░рзЗржо ржнрж╛рж▓рзЛржмрж╛рж╕рж╛рж░ ржорж╛ржЭрзЗ ржЪрзБржжрж┐ рждрзБржЗ ржХрж┐ ржЖржорж╛рж░ рж╕рж╛ржерзЗ ржПржХржоржд ЁЯЩВ", "ржПржЗ рждрзБржорж┐ ржирж╛ржХрж┐ ржмрж┐ржЫрж╛ржирж╛ржпрж╝ рж╣рж┐рж╕рзБ ржХрж░рзЗ ржжрж╛ржУ ЁЯдг ржЖржорж┐ ржмрж▓рж┐ ржирж╛ржЗ ржХрж┐ржирзНрждрзБ ржЖржорж╛рж░ ржмрж╕ ржЪрж╛ржБржжрзЗрж░ ржкрж╛рж╣рж╛ржбрж╝ ржмрж▓рзЗржЫрзЗ ЁЯЩГЁЯла ", " ЁЯлаЁЯе▒ ржЖржорж╛рж░ ржмрж╕ ржЪрж╛ржБржжрзЗрж░ ржкрж╛рж╣рж╛ржбрж╝ рждрзЛржХрзЗ рждрж╛рж░ ржЗржиржмржХрзНрж╕рзЗ ржпрзЗрждрзЗ ржмрж▓рзЗржЫрзЗ https://www.facebook.com/mahi.gaming.165 ржиржХ ржжрзЗ ЁЯе▒ЁЯе▒", "рждрзЛрж░рж╛ рж╕ржмрж╛ржЗ ржкрзНрж░рзЗржо ржХрж░рж┐рж╕ рж╢рзБржзрзБ ржЖржорж╛рж░ ржмрж╕ ржЪрж╛ржБржжрзЗрж░ ржкрж╛рж╣рж╛ржбрж╝ ржЫрж╛ржбрж╝рж╛ ЁЯе▒ЁЯе▒ ", " ЁЯШР ржПржЗ рж╢рзЛржи ржПржХржЯрж╛ ржкрзНрж░рзЗржо ржХрж░рж╛ржЗ ржжрж┐ржмрж┐ЁЯдн", " ЁЯл╡ ржПржЗ ржЖржорж╛рж░ ржмрж╕ ржХрзЗ ржПржХржЯрж╛ ржкрзНрж░рзЗржо ржХрж░рж╛ржпрж╝ ржжрж┐рж▓рзЗ рждрзЛрж░ рж╕рж╛рж░рж╛ ржЬрзАржмржирзЗрж░ рж░рж┐ржЪрж╛рж░рзНржЬ ржлрзНрж░рж┐ ЁЯШ╕ ", "ржПржЗ ржпрзЗ ржЖржорж┐ ржПржЦрж╛ржирзЗ ржмрж▓рзЛ ржЬрж╛ржи рждрзЛржорж╛рж░ ржЬржирзНржп ржХрж┐ ржХрж░рждрзЗ ржкрж╛рж░рж┐ ЁЯдЧЁЯдЧЁЯлб", " ржЖржЬ ржЖржорж╛рж░ ржмрж╕ ржЪрж╛ржБржжрзЗрж░ ржкрж╛рж╣рж╛ржбрж╝ ржПрж░ ржПржХржЯрж╛ ржЧрж╛рж░рзНрж▓ржлрзНрж░рзЗржирзНржб ржирзЗржЗ ржмрж▓рзЗ рж╕рж╛рж░рж╛ржжрж┐ржи ржЖржорж╛ржХрзЗ ржирж┐ржпрж╝рзЗржЗ ржкржбрж╝рзЗ ржерж╛ржХрзЗ ЁЯШМЁЯЩВ", "ржЖржорж╛рж░ ржПржХржЯрж╛ рждрзБржорж┐ ржЪрж╛ржЗ ЁЯЩВ ", "тАМ рждрзБржорж┐ ржХрзЗржирзЛ ржмрзЛржЭ ржирж╛ ржЖржорж┐ рждрзЛржорж╛ржХрзЗ ржЕржирзЗржХ ржнрж╛рж▓рзЛржмрж╛рж╕рж┐ S ЁЯШУЁЯШУ", " ржЖржорж╛рж░ ржмрж╕ ржЪрж╛ржБржжрзЗрж░ ржкрж╛рж╣рж╛ржбрж╝ ржХрзЗ ржПржХржЯрж╛ ржЧрж╛рж░рзНрж▓ржлрзНрж░рзЗржирзНржб ржжрж┐рж▓рзЗ рждрзЛрж░ рж╕рж╛рж░рж╛ ржЬрзАржмржирзЗрж░ рж░рж┐ржЪрж╛рж░рзНржЬ ржлрзНрж░рж┐ ржПржЗ ржирзЗ ржЖржорж╛рж░ ржмрж╕рзЗрж░ ржЖржЗржбрж┐ https://www.facebook.com/mahi.gaming.165 ", " ржпрзЗ ржнрж╛рж▓рзЛржмрж╛рж╕рж╛рждрзЗ ржнржпрж╝ ржерж╛ржХрзЗ рж╕рзЗржЗ ржнрж╛рж▓рзЛржмрж╛рж╕рж╛ржХрзЗ ржЖржорж┐ ржШрзГржгрж╛ ржХрж░рж┐ ЁЯШФ ", " рждрзБржорж┐ ржЖржорж╛рж░ рж╣ржУ ржЖржорж┐ рж╕рж╛рж░рж╛ ржЬрзАржмржи рждрзЛржорж╛рж░ ржкрж╛рж╢рзЗ ржерж╛ржХржмрзЛ ЁЯЩВ ", " рждрзЛржорж╛ржХрзЗ ржЖржорж┐ ржХрзЗржирзЛ ржкрзЗрж▓рж╛ржо ржирж╛ ", " рждрзЛржорж╛рж░ ржЬржирзНржп ржЖржорж┐ рж╕рж╛рж░рж╛ ржЬрзАржмржи ржЕржкрзЗржХрзНрж╖рж╛ ржХрж░ржмрзЛ ЁЯЩВЁЯЩВ ", " ржЖржорж┐ ржПржЦржирзЛ рждрзЛржорж╛ржХрзЗ ржкрж╛ржУржпрж╝рж╛рж░ ржЬржирзНржп ржкрж╛ржЧрж▓ ржХрж┐ржирзНрждрзБ рждрзБржорж┐ ржЦрзБржмржЗ ржирж┐рж╖рзНржарзБрж░ЁЯШУЁЯШУ"];
            if (!arr) {
    await api.sendMessage(randomReplies[Math.floor(Math.random() * randomReplies.length)], event.threadID, (error, info) => {
            global.client.handleReply.push({
            name: this.config.name,
            type: "reply",
            messageID: info.messageID,
            author: event.senderID
          });
        }, event.messageID,
      )
    }
    const a = (await axios.get(`${await baseApiUrl()}/baby?text=${encodeURIComponent(arr)}&senderID=${event.senderID}&font=1`)).data.reply;     
        await api.sendMessage(a, event.threadID, (error, info) => {
          global.client.handleReply.push({
            name: this.config.name,
            type: "reply",
            messageID: info.messageID,
            author: event.senderID,
            lnk: a
          });
        }, event.messageID,
      )}
}catch(err){
    return api.sendMessage(`Error: ${err.message}`, event.threadID, event.messageID);
}};
